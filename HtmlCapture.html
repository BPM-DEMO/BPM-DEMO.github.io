<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å†™çœŸæ’®å½±</title>

<style>
body {
  font-family: sans-serif;
  padding: 16px;
}
h1 {
  margin-bottom: 12px;
}
button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 12px;
}
input[type=file] {
  display: none;
}
.notice {
  margin-top: 16px;
  font-size: 14px;
  color: #555;
}
</style>
</head>

<body>

<h1>ğŸ“¸ å†™çœŸæ’®å½±</h1>

<button onclick="startCamera()">æ’®å½±ã™ã‚‹</button>

<a href="list.html">
  <button>ä¿å­˜æ¸ˆã¿å†™çœŸã‚’è¦‹ã‚‹</button>
</a>

<div class="notice">
â€» æ’®å½±å¾Œã€Œå†™çœŸã‚’ä½¿ç”¨ã€ã‚’æŠ¼ã™ã¨è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™<br>
â€» é€£ç¶šæ’®å½±ã¯ã“ã®ãƒœã‚¿ãƒ³ã‚’å†åº¦æŠ¼ã—ã¦ãã ã•ã„
</div>

<input
  type="file"
  id="cameraInput"
  accept="image/*"
  capture="environment"
/>

<script>
let db;

/* ===== IndexedDB åˆæœŸåŒ– ===== */
const req = indexedDB.open("photoDB", 1);

req.onupgradeneeded = e => {
  const db = e.target.result;
  if (!db.objectStoreNames.contains("photos")) {
    db.createObjectStore("photos", {
      keyPath: "id",
      autoIncrement: true
    });
  }
};

req.onsuccess = e => {
  db = e.target.result;
};

/* ===== ã‚«ãƒ¡ãƒ©èµ·å‹• ===== */
function startCamera() {
  document.getElementById("cameraInput").value = "";
  document.getElementById("cameraInput").click();
}

/* ===== æ’®å½±å¾Œ â†’ è‡ªå‹•ä¿å­˜ ===== */
document.getElementById("cameraInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => savePhoto(reader.result);
  reader.readAsDataURL(file);
});

/* ===== IndexedDB ã«ä¿å­˜ ===== */
function savePhoto(base64) {
  const tx = db.transaction("photos", "readwrite");
  tx.objectStore("photos").add({
    image: base64,
    created: Date.now()
  });

  tx.oncomplete = () => {
    alert("ä¿å­˜ã—ã¾ã—ãŸ");
  };
}
</script>

</body>
</html>
